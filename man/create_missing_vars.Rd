% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/full_pipeline.R
\name{create_missing_vars}
\alias{create_missing_vars}
\title{Pipeline de MISSINGS: importar ODK, construir spec y generar flags de missing}
\usage{
create_missing_vars(
  path_odk,
  required_value = "yes",
  path_datos,
  sheet_datos = "data_raw",
  prefix = "m",
  numeric_conds = TRUE,
  coerce_target = FALSE,
  return_all = TRUE
)
}
\arguments{
\item{path_odk}{Ruta al archivo XLS/XLSX del formulario ODK.}

\item{required_value}{Valor que indica "obligatorio" en la columna \code{required}
del ODK (p.ej. \code{"yes"} o \code{"TRUE"}). Default: \code{"yes"}.}

\item{path_datos}{Ruta al archivo de datos (XLS/XLSX/CSV). Si es Excel,
usar \code{sheet_datos} para especificar la hoja.}

\item{sheet_datos}{(opcional) Nombre o índice de hoja en \code{path_datos}
cuando es Excel. Default: \code{"data_raw"}.}

\item{prefix}{Prefijo para los flags de missing por variable. Default: \code{"m"}.}

\item{numeric_conds}{Si \code{TRUE}, las condiciones se comparan como numéricas
y los \code{when_values} deben ser numéricos. Default: \code{TRUE}.}

\item{coerce_target}{Si \code{TRUE}, convierte el target a numérico antes de
evaluar \code{is.na}; si \code{FALSE}, no lo convierte. Default: \code{FALSE}.}

\item{return_all}{Si \code{TRUE}, devuelve una lista con objetos intermedios
(ODK filtrado, spec, datos con tokens). Si \code{FALSE}, devuelve sólo
el data.frame final con flags y sumas. Default: \code{TRUE}.}
}
\value{
Si \code{return_all = TRUE}, una lista con:
\describe{
\item{data}{Base final con flags \code{<prefix>_var}, \code{total_missing} y \code{flag_missing}.}
\item{ODK_filtrado}{Salida de \code{import_odk_propagate_required()}.}
\item{spec_for_flags}{Especificación construida por \code{build_spec_for_flags()}.}
\item{datos_tokens}{Datos con tokens/dummies añadidos por \code{build_spec_for_flags()}.}
}
Si \code{return_all = FALSE}, devuelve sólo \code{data}.
}
\description{
Ejecuta el flujo completo para crear flags de missing a partir de un XLSForm ODK
y una base de datos de respuestas:
\enumerate{
\item Importa y propaga relevancias del ODK (filtrando obligatorias).
\item Construye \code{spec_for_flags} y genera tokens/dummies necesarios.
\item Crea columnas de alertas de missing (\code{prefix_}*) por variable.
\item Suma las alertas y crea \code{total_missing} y \code{flag_missing}.
}
}
\details{
Requiere que existan previamente las funciones:
\itemize{
\item \code{import_odk_propagate_required()}
\item \code{build_spec_for_flags()}
\item \code{flags_missing_por_variable()}
}
}
\examples{
\dontrun{
res <- create_missing_vars(
  path_odk      = "C:/Users/julia/Downloads/Encuesta Niubiz MS 2025 (2).xlsx",
  required_value = "yes",
  path_datos    = "C:/Users/julia/Downloads/Alertas - NIUBIZ.xlsx",
  sheet_datos   = "data_raw",
  prefix        = "m",
  numeric_conds = TRUE,
  coerce_target = FALSE
)

head(res$data)
}
}
